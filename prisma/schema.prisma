// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                 Int               @id @default(autoincrement())
  name               String?
  email              String            @unique
  password           String
  role               Role              @default(CANDIDATE)
  status             Boolean           @default(true)
  candidateProfile   CandidateProfile?
  companies          Company[]
  jobs               Job[]
}

model CandidateProfile{
  id                   Int     @id @default(autoincrement())
  user                 User    @relation(fields: [userId], references: [id])
  userId               Int     @unique
  fullName             String
  gender               Gender
  phone                String
  cv                   String
  birthday             DateTime @db.Date
  address              String
  openToWork           Boolean  @default(false)
  status               Boolean  @default(true)
  candidateLanguages   CandidateLanguage[]
  candidateEducations  CandidateEducation[]
  candidateExperiences CandidateExperience[]
  applications         Apply[]
}

model Language {
  name                String    @id
  candidateLanguages  CandidateLanguage[]
}

model CandidateLanguage {
  candidateProfile     CandidateProfile @relation(fields: [candidateProfileId], references: [id])
  candidateProfileId   Int
  language             Language         @relation(fields: [languageName], references: [name])
  languageName         String
  level                Level            @default(BASIC)

  @@unique([candidateProfileId, languageName])
}

model Education{
  id                  Int              @id @default(autoincrement())
  name                String
  map                 String
  slug                String           @unique
  candidateEducations CandidateEducation[]
}

model CandidateEducation{
  candidateProfile    CandidateProfile @relation(fields: [candidateProfileId], references: [id])
  candidateProfileId  Int
  education           Education       @relation(fields: [educationId], references: [id])
  educationId         Int
  major               String
  degree              String
  yearStart           Int
  yearEnd             Int

  @@unique([candidateProfileId, educationId])
}

model CandidateExperience {
  id                  Int              @id @default(autoincrement())
  candidateProfile    CandidateProfile @relation(fields: [candidateProfileId], references: [id])
  candidateProfileId  Int
  company             String
  department          String
  responsibilities    String
  startDate           DateTime          @db.Date
  endDate             DateTime?         @db.Date
  currentlyWorking    Boolean           @default(false)
}

model Company {
  id                  Int              @id @default(autoincrement())
  user                User             @relation(fields: [userId], references: [id])
  userId              Int
  name                String
  description         String
  address             String
  teamSize            Int
  estDate             DateTime         @db.Date
  views               Int              @default(0)
  websiteUrl          String?
  isApproved          Boolean          @default(false)
  mapLink             String?
  images              CompanyImage[]
  industries          CompanyIndustry[]
  jobs                Job[]
}

model CompanyImage {
  id                  Int              @id @default(autoincrement())
  company             Company          @relation(fields: [companyId], references: [id])
  companyId           Int
  imageUrl            String
}

model Industry{
  id                  Int              @id @default(autoincrement())
  name                String
  slug                String           @unique
  description         String
  industries          CompanyIndustry[]
}

model CompanyIndustry{
  company             Company          @relation(fields: [companyId], references: [id])
  companyId           Int
  industry            Industry         @relation(fields: [industryId], references: [id])
  industryId          Int

  @@unique([companyId, industryId])
}

model JobRole{
  id                  Int              @id @default(autoincrement())
  name                String
  slug                String           @unique
  description         String?
  jobs                Job[]
}

model Job{
  id                  Int              @id @default(autoincrement())
  company             Company          @relation(fields: [companyId], references: [id])
  companyId           Int
  user                User             @relation(fields: [userId], references: [id])
  userId              Int
  jobRole             JobRole          @relation(fields: [jobRoleId], references: [id])
  jobRoleId           Int
  title               String
  description         String
  slug                String           @unique
  status              JobStatus        @default(ACTIVE)
  minSalary           Int
  maxSalary           Int
  totalViews          Int              @default(0)
  createdAt           DateTime         @default(now())
  updatedAt           DateTime?        @updatedAt
  skills              JobSkill[]
  applications        Apply[]
}

model Skill{
  id                  Int              @id @default(autoincrement())
  name                String
  slug                String           @unique
  skills              JobSkill[]
}

model JobSkill{
  id                  Int              @id @default(autoincrement())
  job                 Job              @relation(fields: [jobId], references: [id])
  jobId               Int
  skill               Skill            @relation(fields: [skillId], references: [id])
  skillId             Int
}

model Apply{
  job                 Job              @relation(fields: [jobId], references: [id])
  jobId               Int
  candidate           CandidateProfile @relation(fields: [candidateProfileId], references: [id])
  candidateProfileId  Int
  appliedAt           DateTime         @default(now())
  status              AppStatus        @default(APPLIED)

  @@id([jobId, candidateProfileId])
}

enum Role {
  ADMIN
  RECRUITER
  CANDIDATE
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Level{
  BASIC
  INTERMEDIATE
  ADVANCED
}

enum JobStatus{
  PENDING
  ACTIVE
  EXPIRED
  REJECTED
}

enum AppStatus{
  APPLIED
  UNDER_REVIEW
  INTERVIEW_SCHEDULED
  OFFERED
  REJECTED
}